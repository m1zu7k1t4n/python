	LIST	P=PIC16F84A
	INCLUDE	"P16F84A.INC"
	
	__CONFIG	_HS_OSC&_CP_OFF&_WDT_OFF&_PWRTE_ON

W_TMP	EQU	0CH
ST_TMP	EQU	0DH
TMP	EQU	0EH
TMP2	EQU	0FH
FLG	EQU	10H
RND1	EQU	11H
RND2	EQU	12H
RTEMP	EQU	13H
SCOREL	EQU	14H
SCORER	EQU	15H
MLT1_1	EQU	16H
MLT1_2	EQU	17H
MLT1_3	EQU	18H
MLT2_1	EQU	19H
MLT2_2	EQU	1AH
MLT2_3	EQU	1BH
MOLES	EQU	1CH
TEST	EQU	1DH

CNT1	EQU	1EH
CNT2	EQU	1FH
CNT3	EQU	20H
CNT4	EQU	21H
CNT5	EQU	22H
CNT6	EQU	23H
CNT7	EQU	24H

MAINT1	EQU	25H
MAINT2	EQU	26H
MAINT3	EQU	27H

	ORG	0H
	CALL	DEF
	GOTO	MAIN
	ORG	04H

;PUSH
	MOVWF	W_TMP
	MOVF	STATUS,	W
	MOVWF	ST_TMP
	MOVF	PORTB,	W
	MOVWF	TMP2
	MOVWF	TMP

	CLRF	FLG
	BCF	STATUS,	0
	BTFSC	TMP,	7
	BSF	FLG,	7
	BTFSC	TMP,	6
	BSF	FLG,	6
	RLF	TMP,	F
	RLF	TMP,	W
	ANDWF	FLG,	F
	MOVF	TMP2,	W
	MOVWF	TMP
	COMF	TMP,	F
	RRF	TMP2,	F
	RRF	TMP2,	W
	ANDWF	TMP,	W
	ANDLW	B'00110000'
	IORWF	FLG,	F
		
	;BTFSC	FLG,	7
	;CALL	HITSE
	;BTFSC	FLG,	6
	;CALL	HITSE
	;BTFSC	FLG,	5
	;CALL	MISSSE
	;BTFSC	FLG,	4
	;CALL	MISSSE
	CALL	SCORE
	;BCF	STATUS,	0
	RLF	SCORER,	W
	MOVWF	PORTA
	BSF	PORTA,	0
	;BCF	PORTA,	4
	;BTFSS	SCORER,	3
	;BSF	PORTA,	4
	MOVLW	B'11110000'
	ANDWF	PORTB,	F
	MOVF	SCOREL,	W
	IORWF	PORTB

;POP
	MOVF	ST_TMP,	W
	MOVWF	STATUS
	SWAPF	W_TMP,	F
	SWAPF	W_TMP,	W
	BCF	INTCON,	RBIF
	RETFIE

DEF	CLRF	SCORER
	CLRF	SCOREL
	CLRF	PORTA
	CLRF	PORTB
	RETURN

MOLE1	DECFSZ	MLT1_1,	F
	RETURN
	MOVF	RND1,	W
	MOVWF	MLT1_1
	DECFSZ	MLT1_2,	F
	RETURN
	MOVF	RND1,	W
	MOVWF	MLT1_2
	DECFSZ	MLT1_3,	F
	RETURN
	MOVF	RND1,	W	
	ANDLW	B'00010000'	
	MOVWF	RTEMP
	RRF	RTEMP,	F
	RRF	RTEMP,	F	
	MOVF	RND1,	W	
	ANDLW	B'00000100'	
	XORWF	RTEMP,	F
	RRF	RTEMP,	F
	RRF	RTEMP,	F	
	MOVF	RND1,	W	
	ANDLW	B'00000001'	
	XORWF	RTEMP,	F
	RRF	RTEMP,	F
	RRF	RND1,	F
	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	;MOVLW	002H
	;MOVWF	RND1
	MOVF	RND1,	W
	MOVWF	MLT1_1
	;;;;;;;;;;;
	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	;MOVLW	002H
	MOVF	RND1,	W
	;;;;;;;;;;
	MOVWF	MLT1_2
	MOVLW	015H
	;MOVLW	002H
	MOVWF	MLT1_3
	MOVF	MOLES,	W
	ANDLW	B'00100000'	
	COMF	MOLES,	W
	MOVWF	TEST
	BCF	MOLES,	5
	BCF	PORTB,	5
	BTFSC	TEST,	5
	BSF	MOLES,	5
	BTFSC	MOLES,	5
	BSF	PORTB,	5
	RETURN


MOLE2	DECFSZ	MLT2_1,	F
	RETURN
	MOVF	RND2,	W
	MOVWF	MLT2_1
	DECFSZ	MLT2_2,	F
	RETURN
	MOVF	RND2,	W
	MOVWF	MLT2_2
	DECFSZ	MLT2_3,	F
	RETURN
	MOVF	RND2,	W	
	ANDLW	B'00010000'	
	MOVWF	RTEMP
	RRF	RTEMP,	F
	RRF	RTEMP,	F	
	MOVF	RND2,	W	
	ANDLW	B'00000100'	
	XORWF	RTEMP,	F
	RRF	RTEMP,	F
	RRF	RTEMP,	F	
	MOVF	RND2,	W	
	ANDLW	B'00000001'	
	XORWF	RTEMP,	F
	RRF	RTEMP,	F
	RRF	RND2,	F
	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	;MOVLW	002H
	;MOVWF	RND1
	MOVF	RND2,	W
	MOVWF	MLT2_1
	;;;;;;;;;;;
	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	;MOVLW	002H
	MOVF	RND2,	W
	;;;;;;;;;;
	MOVWF	MLT2_2
	MOVLW	015H
	;MOVLW	002H
	MOVWF	MLT2_3
	MOVF	MOLES,	W
	ANDLW	B'00100000'	
	COMF	MOLES,	W
	MOVWF	TEST
	BCF	MOLES,	4
	BCF	PORTB,	4
	BTFSC	TEST,	4
	BSF	MOLES,	4
	BTFSC	MOLES,	4
	BSF	PORTB,	4
	RETURN


MAIN	BCF	INTCON,	GIE
	BSF	STATUS,	RP0
	CLRF	TRISA
	MOVLW	B'11000000'
	MOVWF	TRISB
	BCF	STATUS,	RP0
	;CLRF	PORTA
	;CLRF	PORTB
	BSF	PORTA,	0
	CLRF	FLG
	CLRF	TMP
	CLRF	TMP2
	MOVLW	B'10100101'
	MOVWF	RND1
	MOVLW	B'00100001'
	MOVWF	RND2
	;CLRF	SCOREL
	;MOVLW	007H
	;MOVWF	SCOREL
	;CLRF	SCORER
	;MOVLW	009H
	;MOVWF	SCORER
	MOVLW	001H
	MOVWF	MLT1_1
	MOVWF	MLT1_2
	MOVWF	MLT1_3
	MOVWF	MLT2_1
	MOVWF	MLT2_2
	MOVWF	MLT2_3
	MOVLW	0FFH
	MOVWF	MAINT1
	MOVWF	MAINT2
	MOVLW	024H
	MOVWF	MAINT3
	GOTO	WAITLOOP


WAITLOOP	BTFSC	PORTB,	7
	GOTO	OP1
	BTFSS	PORTB,	6
	GOTO	WAITLOOP
	GOTO	OP2

OP1	CALL	SFUN
	GOTO	SLOOP

OP2	CALL	SFUN2
	GOTO	SLOOP

SLOOP	MOVLW	006H
	CALL	TIMER2
	CLRF	SCORER
	CLRF	SCOREL
	CLRF	PORTA
	CLRF	PORTB
	BSF	INTCON,	RBIE
	BSF	INTCON,	GIE
	BCF	INTCON,	RBIF
LOOP	CALL	MOLE1
	CALL	MOLE2
	BTFSC	FLG,	7
	CALL	HITSE
	BTFSC	FLG,	6
	CALL	HITSE
	BTFSC	FLG,	5
	CALL	MISSSE
	BTFSC	FLG,	4
	CALL	MISSSE
	CLRF	FLG
	DECFSZ	MAINT1,	F
	GOTO	LOOP
	MOVLW	0FFH
	MOVWF	MAINT1
	DECFSZ	MAINT2,	F
	GOTO	LOOP
	MOVLW	0FFH
	MOVWF	MAINT2
	DECFSZ	MAINT3,	F
	GOTO	LOOP
	GOTO	E_ROLL

MISSSE	MOVLW	0FFH
	CALL	M_A2
	MOVLW	001H
	MOVWF	MAINT2
	RETURN

HITSE	MOVLW	030H
	CALL	M_B1
	MOVLW	055H
	CALL	M_E2
	MOVLW	001H
	MOVWF	MAINT2
	RETURN

E_ROLL	BCF	INTCON,	GIE
	CALL	EFUN
	BCF	PORTA,	0
	MOVLW	00AH
	CALL	TIMER2
	BSF	PORTA,	0
	MOVLW	00AH
	CALL	TIMER2
	BCF	PORTA,	0
	MOVLW	00AH
	CALL	TIMER2
	BSF	PORTA,	0
	MOVLW	00AH
	CALL	TIMER2
	BCF	PORTA,	0
	MOVLW	00AH
	CALL	TIMER2
	BSF	PORTA,	0
	GOTO	MAIN

SCORE	BTFSC	FLG,	7
	CALL	SCUP
	BTFSC	FLG,	6
	CALL	SCUP
	BTFSC	FLG,	5
	CALL	SCDW
	BTFSC	FLG,	4
	CALL	SCDW
	RETURN

SCUP	INCF	SCORER,	F
	BTFSS	SCORER,	3
	RETURN
	BTFSS	SCORER,	1
	RETURN
	CLRF	SCORER
	INCF	SCOREL
	BTFSS	SCOREL,	3
	RETURN
	BTFSS	SCOREL,	1
	RETURN
	CLRF	SCOREL
	RETURN

SCDW	BTFSC	SCORER,	0
	GOTO	RBACK
	BTFSC	SCORER,	1
	GOTO	RBACK
	BTFSC	SCORER,	2
	GOTO	RBACK
	BTFSC	SCORER,	3
	GOTO	RBACK
	BTFSC	SCOREL,	0
	GOTO	LBACK
	BTFSC	SCOREL,	1
	GOTO	LBACK
	BTFSC	SCOREL,	2
	GOTO	LBACK
	BTFSC	SCOREL,	3
	GOTO	LBACK
	RETURN

RBACK	DECF	SCORER
	RETURN

LBACK	MOVLW	B'00001001'
	MOVWF	SCORER
	DECF	SCOREL
	RETURN
	
TIME5U	MOVLW	007H
	MOVWF	CNT1
	NOP
	NOP
LOOP1	DECFSZ	CNT1,	F
	GOTO	LOOP1
	RETURN

TIMER	MOVWF	CNT2
LOOP2	CALL	TIME5U
	DECFSZ	CNT2,	F
	GOTO	LOOP2
	RETURN

TIME100U	MOVLW	0A5H
	MOVWF	CNT4
LOOP3	DECFSZ	CNT4,	F
	GOTO	LOOP3
	RETURN

TIME10M	MOVLW	063H
	MOVWF	CNT5
	NOP
	NOP
LOOP4	CALL	TIME100U
	DECFSZ	CNT5,	F
	GOTO	LOOP4
	RETURN

TIME50M	MOVLW	005H
	MOVWF	CNT6
LOOP5	CALL	TIME10M
	DECFSZ	CNT6,	F
	GOTO	LOOP5
	RETURN

TIMER2	MOVWF	CNT7
LOOP6	CALL	TIME50M
	DECFSZ	CNT7,	F
	GOTO	LOOP6
	RETURN

M_G1	MOVWF	CNT3
LOOPG1	BCF	PORTA,	000H
	MOVLW	0CEH
	CALL	TIMER
	BSF	PORTA,	000H
	MOVLW	0CEH
	CALL	TIMER
	DECFSZ	CNT3,	F
	GOTO	LOOPG1
	RETURN

M_A1	MOVWF	CNT3
LOOPA1	BCF	PORTA,	000H
	MOVLW	0B8H
	CALL	TIMER
	BSF	PORTA,	000H
	MOVLW	0B8H
	CALL	TIMER
	DECFSZ	CNT3,	F
	GOTO	LOOPA1
	RETURN

M_B1	MOVWF	CNT3
LOOPB1	BCF	PORTA,	000H
	MOVLW	0A3H
	CALL	TIMER
	BSF	PORTA,	000H
	MOVLW	0A3H
	CALL	TIMER
	DECFSZ	CNT3,	F
	GOTO	LOOPB1
	RETURN

M_C2	MOVWF	CNT3
LOOPC2	BCF	PORTA,	000H
	MOVLW	09AH
	CALL	TIMER
	BSF	PORTA,	000H
	MOVLW	09AH
	CALL	TIMER
	DECFSZ	CNT3,	F
	GOTO	LOOPC2
	RETURN

M_D2	MOVWF	CNT3
LOOPD2	BCF	PORTA,	000H
	MOVLW	08AH
	CALL	TIMER
	BSF	PORTA,	000H
	MOVLW	08AH
	CALL	TIMER
	DECFSZ	CNT3,	F
	GOTO	LOOPD2
	RETURN

M_E2	MOVWF	CNT3
LOOPE2	BCF	PORTA,	000H
	MOVLW	07AH
	CALL	TIMER
	BSF	PORTA,	000H
	MOVLW	07AH
	CALL	TIMER
	DECFSZ	CNT3,	F
	GOTO	LOOPE2
	RETURN

M_F2	MOVWF	CNT3
LOOPF2	BCF	PORTA,	000H
	MOVLW	073H
	CALL	TIMER
	BSF	PORTA,	000H
	MOVLW	073H
	CALL	TIMER
	DECFSZ	CNT3,	F
	GOTO	LOOPF2
	RETURN

M_G2	MOVWF	CNT3
LOOPG2	BCF	PORTA,	000H
	MOVLW	067H
	CALL	TIMER
	BSF	PORTA,	000H
	MOVLW	067H
	CALL	TIMER
	DECFSZ	CNT3,	F
	GOTO	LOOPG2
	RETURN

M_A2	MOVWF	CNT3
LOOPA2	BCF	PORTA,	000H
	MOVLW	05CH
	CALL	TIMER
	BSF	PORTA,	000H
	MOVLW	05CH
	CALL	TIMER
	DECFSZ	CNT3,	F
	GOTO	LOOPA2
	RETURN

SFUN	MOVLW	079H
	CALL	M_A1
	MOVLW	00AH
	CALL	TIMER2
	MOVLW	079H
	CALL	M_A1
	MOVLW	00AH
	CALL	TIMER2
	MOVLW	079H
	CALL	M_A1
	MOVLW	00AH
	CALL	TIMER2
	MOVLW	0FFH
	CALL	M_A2
	MOVLW	079H
	CALL	M_A2
	RETURN

EFUN	MOVLW	022H
	CALL	M_D2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	022H
	CALL	M_D2
	MOVLW	004H
	CALL	TIMER2
	MOVLW	033H
	CALL	M_E2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	033H
	CALL	M_E2
	MOVLW	004H
	CALL	TIMER2
	MOVLW	03CH
	CALL	M_F2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	03CH
	CALL	M_F2
	MOVLW	004H
	CALL	TIMER2
	MOVLW	055H
	CALL	M_G2
	MOVLW	044H
	CALL	M_F2
	MOVLW	055H
	CALL	M_G2
	MOVLW	0FFH
	CALL	M_A2
	RETURN

SFUN2	MOVLW	0FFH
	CALL	M_D2
	MOVLW	008H
	CALL	TIMER2;;;;;;;;;;
	MOVLW	038H
	CALL	M_D2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	038H
	CALL	M_D2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	0FFH
	CALL	M_D2
	MOVLW	008H
	CALL	TIMER2;;;;;;;;;;;;
	MOVLW	038H
	CALL	M_D2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	038H
	CALL	M_D2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	0FFH
	CALL	M_F2
	MOVLW	0CFH
	CALL	M_F2
	MOVLW	011H
	CALL	TIMER2;;;;;;;;;;;;
	MOVLW	077H
	CALL	M_E2
	MOVLW	057H
	CALL	M_C2
	MOVLW	03FH
	CALL	M_G1
	MOVLW	0FFH
	CALL	M_F2
	MOVLW	0CFH
	CALL	M_F2
	MOVLW	011H
	CALL	TIMER2;;;;;;;;;;;;
	MOVLW	077H
	CALL	M_E2
	MOVLW	057H
	CALL	M_C2
	MOVLW	03FH
	CALL	M_G1
	MOVLW	0FFH
	CALL	M_D2
	MOVLW	08FH
	CALL	M_D2
	MOVLW	011H
	CALL	TIMER2;;;;;;;;;;;;;
	MOVLW	07FH
	CALL	M_G1
	MOVLW	0FFH
	CALL	TIMER
	MOVLW	04FH
	CALL	M_G1
	MOVLW	0FFH
	CALL	M_D2
	MOVLW	01FH
	CALL	M_D2
	MOVLW	0FFH
	CALL	M_F2
	MOVLW	04FH
	CALL	M_F2
	MOVLW	0FFH
	CALL	M_E2
	MOVLW	03FH
	CALL	M_E2
	MOVLW	0FFH
	CALL	M_C2
	MOVLW	01FH
	CALL	M_C2
	MOVLW	0AFH
	CALL	M_G1
	MOVLW	0FFH
	CALL	M_D2
	MOVLW	0CFH
	CALL	M_D2
	MOVLW	011H
	CALL	TIMER2;;;;;;;;;;
	MOVLW	07FH
	CALL	M_G1
	MOVLW	0FFH
	CALL	TIMER
	MOVLW	04FH
	CALL	M_G1
	MOVLW	0FFH
	CALL	M_D2
	MOVLW	01FH
	CALL	M_D2
	MOVLW	0FFH
	CALL	M_F2
	MOVLW	04FH
	CALL	M_F2
	MOVLW	0FFH
	CALL	M_E2
	MOVLW	03FH
	CALL	M_E2
	MOVLW	0FFH
	CALL	M_A2
	MOVLW	09FH
	CALL	M_A2
	MOVLW	0FFH
	CALL	M_F2
	MOVLW	05FH
	CALL	M_F2
	MOVLW	0FFH
	CALL	M_G2
	MOVLW	07FH
	CALL	M_G2
	MOVLW	008H
	CALL	TIMER2;;;;;;;;;;;
	MOVLW	08FH
	CALL	M_G2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	08FH
	CALL	M_G2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	08FH
	CALL	M_G2
	MOVLW	001H
	CALL	TIMER2
	MOVLW	0FFH
	CALL	M_G2
	MOVLW	0FFH
	CALL	M_G2
	MOVLW	0FFH
	CALL	M_G2
	MOVLW	002H
	CALL	TIMER2
	RETURN


	END